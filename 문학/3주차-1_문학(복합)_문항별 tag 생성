{"cells":[{"cell_type":"markdown","metadata":{"id":"KiOQqoaFr9xC"},"source":["# **0. 패키지 설치**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":39243,"status":"ok","timestamp":1750413226556,"user":{"displayName":"김현주/컴퓨터공학부","userId":"13373004077348590592"},"user_tz":-540},"id":"3_3-jzXMaaaP","outputId":"1e93c3d1-c4ec-475f-b0e8-c0dca45d5312"},"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: langchain in /usr/local/lib/python3.11/dist-packages (0.3.25)\n","Collecting langchain-community\n","  Downloading langchain_community-0.3.25-py3-none-any.whl.metadata (2.9 kB)\n","Requirement already satisfied: langchain-core in /usr/local/lib/python3.11/dist-packages (0.3.65)\n","Requirement already satisfied: langchain-text-splitters<1.0.0,>=0.3.8 in /usr/local/lib/python3.11/dist-packages (from langchain) (0.3.8)\n","Requirement already satisfied: langsmith<0.4,>=0.1.17 in /usr/local/lib/python3.11/dist-packages (from langchain) (0.3.45)\n","Requirement already satisfied: pydantic<3.0.0,>=2.7.4 in /usr/local/lib/python3.11/dist-packages (from langchain) (2.11.7)\n","Requirement already satisfied: SQLAlchemy<3,>=1.4 in /usr/local/lib/python3.11/dist-packages (from langchain) (2.0.41)\n","Requirement already satisfied: requests<3,>=2 in /usr/local/lib/python3.11/dist-packages (from langchain) (2.32.3)\n","Requirement already satisfied: PyYAML>=5.3 in /usr/local/lib/python3.11/dist-packages (from langchain) (6.0.2)\n","Requirement already satisfied: aiohttp<4.0.0,>=3.8.3 in /usr/local/lib/python3.11/dist-packages (from langchain-community) (3.11.15)\n","Requirement already satisfied: tenacity!=8.4.0,<10,>=8.1.0 in /usr/local/lib/python3.11/dist-packages (from langchain-community) (9.1.2)\n","Collecting dataclasses-json<0.7,>=0.5.7 (from langchain-community)\n","  Downloading dataclasses_json-0.6.7-py3-none-any.whl.metadata (25 kB)\n","Collecting pydantic-settings<3.0.0,>=2.4.0 (from langchain-community)\n","  Downloading pydantic_settings-2.9.1-py3-none-any.whl.metadata (3.8 kB)\n","Collecting httpx-sse<1.0.0,>=0.4.0 (from langchain-community)\n","  Downloading httpx_sse-0.4.0-py3-none-any.whl.metadata (9.0 kB)\n","Requirement already satisfied: numpy>=1.26.2 in /usr/local/lib/python3.11/dist-packages (from langchain-community) (2.0.2)\n","Requirement already satisfied: jsonpatch<2.0,>=1.33 in /usr/local/lib/python3.11/dist-packages (from langchain-core) (1.33)\n","Requirement already satisfied: packaging<25,>=23.2 in /usr/local/lib/python3.11/dist-packages (from langchain-core) (24.2)\n","Requirement already satisfied: typing-extensions>=4.7 in /usr/local/lib/python3.11/dist-packages (from langchain-core) (4.14.0)\n","Requirement already satisfied: aiohappyeyeballs>=2.3.0 in /usr/local/lib/python3.11/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain-community) (2.6.1)\n","Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.11/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain-community) (1.3.2)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.11/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain-community) (25.3.0)\n","Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.11/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain-community) (1.7.0)\n","Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.11/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain-community) (6.4.4)\n","Requirement already satisfied: propcache>=0.2.0 in /usr/local/lib/python3.11/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain-community) (0.3.2)\n","Requirement already satisfied: yarl<2.0,>=1.17.0 in /usr/local/lib/python3.11/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain-community) (1.20.1)\n","Collecting marshmallow<4.0.0,>=3.18.0 (from dataclasses-json<0.7,>=0.5.7->langchain-community)\n","  Downloading marshmallow-3.26.1-py3-none-any.whl.metadata (7.3 kB)\n","Collecting typing-inspect<1,>=0.4.0 (from dataclasses-json<0.7,>=0.5.7->langchain-community)\n","  Downloading typing_inspect-0.9.0-py3-none-any.whl.metadata (1.5 kB)\n","Requirement already satisfied: jsonpointer>=1.9 in /usr/local/lib/python3.11/dist-packages (from jsonpatch<2.0,>=1.33->langchain-core) (3.0.0)\n","Requirement already satisfied: httpx<1,>=0.23.0 in /usr/local/lib/python3.11/dist-packages (from langsmith<0.4,>=0.1.17->langchain) (0.28.1)\n","Requirement already satisfied: orjson<4.0.0,>=3.9.14 in /usr/local/lib/python3.11/dist-packages (from langsmith<0.4,>=0.1.17->langchain) (3.10.18)\n","Requirement already satisfied: requests-toolbelt<2.0.0,>=1.0.0 in /usr/local/lib/python3.11/dist-packages (from langsmith<0.4,>=0.1.17->langchain) (1.0.0)\n","Requirement already satisfied: zstandard<0.24.0,>=0.23.0 in /usr/local/lib/python3.11/dist-packages (from langsmith<0.4,>=0.1.17->langchain) (0.23.0)\n","Requirement already satisfied: annotated-types>=0.6.0 in /usr/local/lib/python3.11/dist-packages (from pydantic<3.0.0,>=2.7.4->langchain) (0.7.0)\n","Requirement already satisfied: pydantic-core==2.33.2 in /usr/local/lib/python3.11/dist-packages (from pydantic<3.0.0,>=2.7.4->langchain) (2.33.2)\n","Requirement already satisfied: typing-inspection>=0.4.0 in /usr/local/lib/python3.11/dist-packages (from pydantic<3.0.0,>=2.7.4->langchain) (0.4.1)\n","Collecting python-dotenv>=0.21.0 (from pydantic-settings<3.0.0,>=2.4.0->langchain-community)\n","  Downloading python_dotenv-1.1.0-py3-none-any.whl.metadata (24 kB)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.11/dist-packages (from requests<3,>=2->langchain) (3.4.2)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.11/dist-packages (from requests<3,>=2->langchain) (3.10)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.11/dist-packages (from requests<3,>=2->langchain) (2.4.0)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.11/dist-packages (from requests<3,>=2->langchain) (2025.6.15)\n","Requirement already satisfied: greenlet>=1 in /usr/local/lib/python3.11/dist-packages (from SQLAlchemy<3,>=1.4->langchain) (3.2.3)\n","Requirement already satisfied: anyio in /usr/local/lib/python3.11/dist-packages (from httpx<1,>=0.23.0->langsmith<0.4,>=0.1.17->langchain) (4.9.0)\n","Requirement already satisfied: httpcore==1.* in /usr/local/lib/python3.11/dist-packages (from httpx<1,>=0.23.0->langsmith<0.4,>=0.1.17->langchain) (1.0.9)\n","Requirement already satisfied: h11>=0.16 in /usr/local/lib/python3.11/dist-packages (from httpcore==1.*->httpx<1,>=0.23.0->langsmith<0.4,>=0.1.17->langchain) (0.16.0)\n","Collecting mypy-extensions>=0.3.0 (from typing-inspect<1,>=0.4.0->dataclasses-json<0.7,>=0.5.7->langchain-community)\n","  Downloading mypy_extensions-1.1.0-py3-none-any.whl.metadata (1.1 kB)\n","Requirement already satisfied: sniffio>=1.1 in /usr/local/lib/python3.11/dist-packages (from anyio->httpx<1,>=0.23.0->langsmith<0.4,>=0.1.17->langchain) (1.3.1)\n","Downloading langchain_community-0.3.25-py3-none-any.whl (2.5 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.5/2.5 MB\u001b[0m \u001b[31m23.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading dataclasses_json-0.6.7-py3-none-any.whl (28 kB)\n","Downloading httpx_sse-0.4.0-py3-none-any.whl (7.8 kB)\n","Downloading pydantic_settings-2.9.1-py3-none-any.whl (44 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m44.4/44.4 kB\u001b[0m \u001b[31m2.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading marshmallow-3.26.1-py3-none-any.whl (50 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m50.9/50.9 kB\u001b[0m \u001b[31m3.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading python_dotenv-1.1.0-py3-none-any.whl (20 kB)\n","Downloading typing_inspect-0.9.0-py3-none-any.whl (8.8 kB)\n","Downloading mypy_extensions-1.1.0-py3-none-any.whl (5.0 kB)\n","Installing collected packages: python-dotenv, mypy-extensions, marshmallow, httpx-sse, typing-inspect, pydantic-settings, dataclasses-json, langchain-community\n","Successfully installed dataclasses-json-0.6.7 httpx-sse-0.4.0 langchain-community-0.3.25 marshmallow-3.26.1 mypy-extensions-1.1.0 pydantic-settings-2.9.1 python-dotenv-1.1.0 typing-inspect-0.9.0\n","Collecting pytesseract\n","  Downloading pytesseract-0.3.13-py3-none-any.whl.metadata (11 kB)\n","Collecting PyPDF2\n","  Downloading pypdf2-3.0.1-py3-none-any.whl.metadata (6.8 kB)\n","Requirement already satisfied: packaging>=21.3 in /usr/local/lib/python3.11/dist-packages (from pytesseract) (24.2)\n","Requirement already satisfied: Pillow>=8.0.0 in /usr/local/lib/python3.11/dist-packages (from pytesseract) (11.2.1)\n","Downloading pytesseract-0.3.13-py3-none-any.whl (14 kB)\n","Downloading pypdf2-3.0.1-py3-none-any.whl (232 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m232.6/232.6 kB\u001b[0m \u001b[31m8.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hInstalling collected packages: pytesseract, PyPDF2\n","Successfully installed PyPDF2-3.0.1 pytesseract-0.3.13\n","Collecting pdfplumber\n","  Downloading pdfplumber-0.11.7-py3-none-any.whl.metadata (42 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m42.8/42.8 kB\u001b[0m \u001b[31m2.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting pdf2image\n","  Downloading pdf2image-1.17.0-py3-none-any.whl.metadata (6.2 kB)\n","Collecting pdfminer.six==20250506 (from pdfplumber)\n","  Downloading pdfminer_six-20250506-py3-none-any.whl.metadata (4.2 kB)\n","Requirement already satisfied: Pillow>=9.1 in /usr/local/lib/python3.11/dist-packages (from pdfplumber) (11.2.1)\n","Collecting pypdfium2>=4.18.0 (from pdfplumber)\n","  Downloading pypdfium2-4.30.1-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (48 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m48.2/48.2 kB\u001b[0m \u001b[31m4.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: charset-normalizer>=2.0.0 in /usr/local/lib/python3.11/dist-packages (from pdfminer.six==20250506->pdfplumber) (3.4.2)\n","Requirement already satisfied: cryptography>=36.0.0 in /usr/local/lib/python3.11/dist-packages (from pdfminer.six==20250506->pdfplumber) (43.0.3)\n","Requirement already satisfied: cffi>=1.12 in /usr/local/lib/python3.11/dist-packages (from cryptography>=36.0.0->pdfminer.six==20250506->pdfplumber) (1.17.1)\n","Requirement already satisfied: pycparser in /usr/local/lib/python3.11/dist-packages (from cffi>=1.12->cryptography>=36.0.0->pdfminer.six==20250506->pdfplumber) (2.22)\n","Downloading pdfplumber-0.11.7-py3-none-any.whl (60 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m60.0/60.0 kB\u001b[0m \u001b[31m6.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading pdfminer_six-20250506-py3-none-any.whl (5.6 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m5.6/5.6 MB\u001b[0m \u001b[31m66.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading pdf2image-1.17.0-py3-none-any.whl (11 kB)\n","Downloading pypdfium2-4.30.1-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.9 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.9/2.9 MB\u001b[0m \u001b[31m78.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hInstalling collected packages: pypdfium2, pdf2image, pdfminer.six, pdfplumber\n","Successfully installed pdf2image-1.17.0 pdfminer.six-20250506 pdfplumber-0.11.7 pypdfium2-4.30.1\n"]}],"source":["!pip install -U langchain langchain-community langchain-core\n","!pip install pytesseract PyPDF2\n","!pip install pdfplumber pdf2image"]},{"cell_type":"code","source":["!sudo apt-get update\n","!sudo apt-get install -y poppler-utils"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"mlsx3PyNqzxw","executionInfo":{"status":"ok","timestamp":1750413244443,"user_tz":-540,"elapsed":17865,"user":{"displayName":"김현주/컴퓨터공학부","userId":"13373004077348590592"}},"outputId":"ef2ba048-60ee-4f98-c418-f3dd8abfec7c"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Get:1 https://cloud.r-project.org/bin/linux/ubuntu jammy-cran40/ InRelease [3,632 B]\n","Get:2 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64  InRelease [1,581 B]\n","Get:3 http://security.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\n","Get:4 https://r2u.stat.illinois.edu/ubuntu jammy InRelease [6,555 B]\n","Get:5 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64  Packages [1,798 kB]\n","Hit:6 http://archive.ubuntu.com/ubuntu jammy InRelease\n","Get:7 http://archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\n","Get:8 https://r2u.stat.illinois.edu/ubuntu jammy/main all Packages [9,051 kB]\n","Get:9 https://ppa.launchpadcontent.net/deadsnakes/ppa/ubuntu jammy InRelease [18.1 kB]\n","Hit:10 https://ppa.launchpadcontent.net/graphics-drivers/ppa/ubuntu jammy InRelease\n","Hit:11 https://ppa.launchpadcontent.net/ubuntugis/ppa/ubuntu jammy InRelease\n","Get:12 https://ppa.launchpadcontent.net/deadsnakes/ppa/ubuntu jammy/main amd64 Packages [33.2 kB]\n","Get:13 http://archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\n","Get:14 http://security.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4,532 kB]\n","Get:15 https://r2u.stat.illinois.edu/ubuntu jammy/main amd64 Packages [2,747 kB]\n","Get:16 http://security.ubuntu.com/ubuntu jammy-security/main amd64 Packages [3,024 kB]\n","Get:17 http://security.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1,253 kB]\n","Get:18 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3,340 kB]\n","Get:19 http://archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4,703 kB]\n","Get:20 http://archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1,561 kB]\n","Fetched 32.5 MB in 5s (5,902 kB/s)\n","Reading package lists... Done\n","W: Skipping acquire of configured file 'main/source/Sources' as repository 'https://r2u.stat.illinois.edu/ubuntu jammy InRelease' does not seem to provide it (sources.list entry misspelt?)\n","Reading package lists... Done\n","Building dependency tree... Done\n","Reading state information... Done\n","The following NEW packages will be installed:\n","  poppler-utils\n","0 upgraded, 1 newly installed, 0 to remove and 40 not upgraded.\n","Need to get 186 kB of archives.\n","After this operation, 697 kB of additional disk space will be used.\n","Get:1 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 poppler-utils amd64 22.02.0-2ubuntu0.8 [186 kB]\n","Fetched 186 kB in 1s (195 kB/s)\n","debconf: unable to initialize frontend: Dialog\n","debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 78, <> line 1.)\n","debconf: falling back to frontend: Readline\n","debconf: unable to initialize frontend: Readline\n","debconf: (This frontend requires a controlling tty.)\n","debconf: falling back to frontend: Teletype\n","dpkg-preconfigure: unable to re-open stdin: \n","Selecting previously unselected package poppler-utils.\n","(Reading database ... 126319 files and directories currently installed.)\n","Preparing to unpack .../poppler-utils_22.02.0-2ubuntu0.8_amd64.deb ...\n","Unpacking poppler-utils (22.02.0-2ubuntu0.8) ...\n","Setting up poppler-utils (22.02.0-2ubuntu0.8) ...\n","Processing triggers for man-db (2.10.2-1) ...\n"]}]},{"cell_type":"markdown","metadata":{"id":"-BC67ybd_0zG"},"source":["# **0. 구글 드라이브 마운트 & api key**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":16702,"status":"ok","timestamp":1750413261164,"user":{"displayName":"김현주/컴퓨터공학부","userId":"13373004077348590592"},"user_tz":-540},"id":"HKc9Ou1b1KcO","outputId":"b22f7df0-d08f-46ea-a7e6-f4fb14c4edeb"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"S-rAxqSqaLz1"},"outputs":[],"source":["import os\n","import openai\n","from langchain.chat_models import ChatOpenAI\n","from langchain_core.output_parsers import StrOutputParser\n","\n","#  API 키 설정\n","OPENAI_API_KEY = \"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\"  # 여기에만 입력하면 아래에서 자동 사용됨\n","os.environ[\"OPENAI_API_KEY\"] = OPENAI_API_KEY\n","client = openai.OpenAI(api_key=OPENAI_API_KEY)"]},{"cell_type":"markdown","source":["# **1. tag 생성**"],"metadata":{"id":"UdL7ignOKzSq"}},{"cell_type":"code","source":["import json\n","import re\n","from tqdm import tqdm\n","import openai\n","\n","# ✅ 프롬프트 템플릿\n","TAG_PROMPT = \"\"\"\n","다음 문학 지문과 문제를 읽고 아래 항목을 JSON 형식으로 작성하세요.\n","\n","📚 입력 정보\n","(지문)\n","{passage}\n","\n","(문제)\n","{question}\n","\n","🧩 복합/단일 판단 기준:\n","- 지문이 2개 이상이면 반드시 \"복합\"으로 분류하세요.\n","- 문제에서 '공통점', '비교', '다음 글들', '(가)와 (나)'라는 표현이 등장하면 반드시 \"복합\"으로 분류하세요.\n","- 위 조건 중 하나라도 충족하면 반드시 \"복합\"으로 분류하세요.\n","- 지문이 1개이거나 지문 여러개 중에서 문제에서 한 특정 지문만 묻는 경우에만 \"단일\"로 분류하세요.\n","⚠️ 복합/단일 분류는 절대 틀리면 안 됩니다. 반드시 주의하세요.\n","\n","🧠 문제 유형 분류 기준 (지문 장르별로 아래 중 하나 선택):\n","\n","- 현대시:\n","  - 내용 이해: 시적 상황, 주제, 정서 및 태도 등 파악\n","  - 정서 및 태도 파악: 화자의 심리와 태도 흐름 이해\n","  - 표현 방식 분석: 비유, 상징, 반복, 설의 등\n","  - 시어 해석: 개별 시어 또는 표현의 상징/중의적 의미 해석\n","  - 상징/비유 해석: 중심 이미지나 상징 구조 해석\n","\n","- 고전 시가:\n","  - 내용 이해: 전체 의미, 작품 흐름, 정서 이해\n","  - 정서 파악: 임에 대한 마음, 자연/현실 인식\n","  - 표현 기법 분석: 고전적 수사 기법 분석 (영탄, 대조, 과장 등)\n","  - 임-화자 관계 이해: 교술/서정 시가에서의 관계 맥락\n","  - 변신/환상 표현 해석: 신화/환상적 요소 해석\n","\n","- 현대 소설:\n","  - 사건 흐름 파악: 줄거리 및 주요 사건 흐름 이해\n","  - 인물 심리 이해: 인물의 성격, 내적 심리, 관계 해석\n","  - 시점 및 서술 방식 분석: 서술자, 시점, 묘사 방식 분석\n","  - 주제/작가 의도 파악: 중심 주제, 주제의식 분석\n","  - 공간/배경 의미 분석: 배경이 가지는 상징적 의미 해석\n","\n","- 고전 소설:\n","  - 내용 이해: 줄거리, 사건 구조 파악\n","  - 인물 심리 및 운명 파악: 주요 인물의 성격과 운명\n","  - 상징 장치 해석: 꿈, 전기, 자연 요소 등 상징 구조 해석\n","  - 권선징악적 관점 분석: 인과적 세계관, 도덕적 교훈 해석\n","  - 서사 구조 분석: 도입-전개-위기-절정-결말의 구조\n","\n","- 극/수필:\n","  - 내용 이해: 상황, 대사, 사건의 흐름 이해\n","  - 표현 특성 분석: 대사, 해설, 장면 구성의 특징\n","  - 서술자의 개입 파악: 수필/극 중 서술자의 위치 및 역할\n","  - 주제 및 교훈 도출: 중심 주제 및 삶에 주는 교훈 해석\n","\n","✒️ 지문 제목 및 작가 추출 기준:\n","- 일반적으로 각 지문 끝에 다음 형식으로 표기됨:\n","  `- 김수영 , ｢그 방을 생각하며｣ -`\n","  → 작가: \"김수영\", 제목: \"그 방을 생각하며\"\n","- 복합 지문일 경우:\n","  - \"지문 제목\": [\"제목1\", \"제목2\", ...]\n","  - \"지문 작가\": [\"작가1\", \"작가2\", ...]\n","  - 작자 미상일 경우 \"작자 미상\"으로 표기\n","\n","📌 출력 형식 (모두 포함):\n","- 출처: 예) \"2022-03-국어_21\"\n","- 문제: 문제 문장 그대로\n","- type: 반드시 \"문학\"\n","- 지문 제목: 문자열 또는 문자열 리스트\n","- 지문 장르: 문자열 또는 리스트 (갈래 복합이면 리스트)\n","- 지문 작가: 문자열 또는 문자열 리스트\n","- 복합/단일: \"복합\" 또는 \"단일\"\n","- 문제 유형: 위 기준 중 적절한 것 하나\n","\n","📌 출력 예시:\n","\n","[지문 1개 예시]\n","{{\n","  \"출처\": \"2022-03-국어_19\",\n","  \"문제\": \"19. ㉠에 대한 이해로 가장 적절한 것은?\",\n","  \"type\": \"문학\",\n","  \"지문 제목\": \"숙향전\",\n","  \"지문 장르\": \"고전 소설\",\n","  \"지문 작가\": \"작자 미상\",\n","  \"복합/단일\": \"단일\",\n","  \"문제 유형\": \"인물 심리 및 운명 파악\"\n","}}\n","\n","[지문 여러개 예시]\n","{{\n","  \"출처\": \"2022-03-국어_24\",\n","  \"문제\": \"24. [A]에 나타난 화자에 대한 이해로 가장 적절한 것은?\",\n","  \"type\": \"문학\",\n","  \"지문 제목\": [\"별사미인곡\", \"제목 없음\", \"백자증정부인박씨묘지명\"],\n","  \"지문 장르\": [\"고전 시가\", \"고전 시가\", \"고전 산문\"],\n","  \"지문 작가\": [\"김춘택\", \"이정보\", \"박지원\"],\n","  \"복합/단일\": \"복합\",\n","  \"문제 유형\": \"정서 파악\"\n","}}\n","\n","⚠️ 반드시 위 기준에 따라 유효한 JSON 형식으로 작성하세요.\n","\"\"\"\n","\n","# ✅ GPT 호출 함수 (기존과 동일)\n","def generate_tag(passage, question, source, passage_code):\n","    prompt = TAG_PROMPT.format(passage=passage, question=question)\n","    try:\n","        resp = client.chat.completions.create(\n","            model=\"gpt-4o-mini\",\n","            temperature=0.7,\n","            max_tokens=1500,\n","            messages=[\n","                {\"role\": \"system\", \"content\": \"당신은 수능 국어 문학 문제 태깅 전문가입니다. JSON만 출력하세요. '지문' 필드는 절대 작성하지 마세요.\"},\n","                {\"role\": \"user\", \"content\": prompt}\n","            ]\n","        )\n","        text = resp.choices[0].message.content.strip()\n","        try:\n","            tag = json.loads(text)\n","        except json.JSONDecodeError:\n","            print(f\"❌ JSON 파싱 실패: {text}\")\n","            return {\"출처\": source, \"오류\": \"JSON 파싱 실패\"}\n","        tag[\"출처\"] = source\n","        tag[\"지문\"] = passage_code  # ✅ 여기서 반드시 코드로 덮어쓰기\n","        return tag\n","    except Exception as e:\n","        print(f\"❌ GPT 요청 오류: {e}\")\n","        return {\"출처\": source, \"오류\": str(e)}\n","\n","# ✅ 지문-문제 파서 개선\n","def parse_literature_file(filepath):\n","    with open(filepath, 'r', encoding='utf-8') as f:\n","        lines = f.readlines()\n","\n","    entries = []\n","    passage = None\n","    passage_code = None\n","    question_code = None\n","    question_buf = []\n","\n","    # 지문/문제 헤더 정규식\n","    passage_header = re.compile(r'^---\\s+(?P<code>[^_]+_p\\d+_\\d+~\\d+)')\n","    question_header = re.compile(r'^---\\s+(?P<code>[^_]+_\\d{1,2})')\n","\n","    for line in lines:\n","        line_strip = line.strip()\n","\n","        # 지문 시작\n","        m_pass = passage_header.match(line_strip)\n","        if m_pass:\n","            # 저장\n","            if question_code:\n","                entries.append({\n","                    'passage_code': passage_code,\n","                    'passage': passage.strip(),\n","                    'question_code': question_code,\n","                    'question': '\\n'.join(question_buf).strip()\n","                })\n","            # 초기화\n","            passage_code = m_pass.group('code')\n","            passage = ''\n","            question_code = None\n","            question_buf = []\n","            mode = 'passage'\n","            continue\n","\n","        # 문제 시작\n","        m_q = question_header.match(line_strip)\n","        if m_q:\n","            if question_code:\n","                # 이전 문제 저장\n","                entries.append({\n","                    'passage_code': passage_code,\n","                    'passage': passage.strip(),\n","                    'question_code': question_code,\n","                    'question': '\\n'.join(question_buf).strip()\n","                })\n","            question_code = m_q.group('code')\n","            question_buf = []\n","            mode = 'question'\n","            continue\n","\n","        if mode == 'passage':\n","            passage += line\n","        elif mode == 'question':\n","            question_buf.append(line_strip)\n","\n","    # 마지막 문제 저장\n","    if question_code:\n","        entries.append({\n","            'passage_code': passage_code,\n","            'passage': passage.strip(),\n","            'question_code': question_code,\n","            'question': '\\n'.join(question_buf).strip()\n","        })\n","\n","    return entries\n","\n","# ✅ 태깅 실행 함수\n","def run_tagging(input_path, output_path):\n","    data = parse_literature_file(input_path)\n","    results = []\n","    for item in tqdm(data):\n","        src = f\"{item['passage_code']}_{item['question_code']}\"\n","        tag = generate_tag(item['passage'], item['question'], src, item['passage_code'])\n","        results.append(tag)\n","    with open(output_path, 'w', encoding='utf-8') as f:\n","        json.dump(results, f, ensure_ascii=False, indent=2)\n","    print(f\"✅ 완료: {output_path}\")\n","\n","# ✅ 실행\n","input_path = '/content/drive/MyDrive/Colab Notebooks/TAVE 프로젝트_STUBO/문학/data/literature_only.txt'\n","output_path = '/content/drive/MyDrive/Colab Notebooks/TAVE 프로젝트_STUBO/문학/data/literature_tagged.json'\n","\n","run_tagging(input_path, output_path)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Ee--3uIOD8ko","executionInfo":{"status":"ok","timestamp":1750413870613,"user_tz":-540,"elapsed":605977,"user":{"displayName":"김현주/컴퓨터공학부","userId":"13373004077348590592"}},"outputId":"417acd30-abd6-403e-e113-8156ab0b4f93"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stderr","text":["100%|██████████| 238/238 [10:03<00:00,  2.53s/it]"]},{"output_type":"stream","name":"stdout","text":["✅ 완료: /content/drive/MyDrive/Colab Notebooks/TAVE 프로젝트_STUBO/문학/data/literature_tagged.json\n"]},{"output_type":"stream","name":"stderr","text":["\n"]}]}],"metadata":{"colab":{"collapsed_sections":["KiOQqoaFr9xC"],"provenance":[],"authorship_tag":"ABX9TyPREMmuE6HVVaeFIBREyFdW"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}